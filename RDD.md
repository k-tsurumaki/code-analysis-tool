# GoコードAI支援型分析ツール 要件定義書

## 1. 背景・目的

Go言語による開発では、静的解析やコード品質向上の重要性が高まっています。本ツールは、GoのAST解析とLLM（大規模言語モデル）を組み合わせ、**コメント自動生成や変数名リファクタ提案、要約生成、アンチパターン検出**等、単純かつ反復的なレビュータスクを自動支援するCLIツールを開発することを目的とします。  
これにより、上級開発者はより高度な設計・レビュ業務に集中でき、新人開発者は自動でベストプラクティスを学習する助けとなります。

---

## 2. 主要要件

### 2.1 機能要件

#### 2.1.1 コード解析タスク（ASTベース）

- 指定したGoファイル（または関数単位）に対し、次の静的解析を実行可能であること
    - コメント不足関数の検出（関数定義直上のGoDocコメントの有無判定）
    - 5つ以上のパラメータを持つ関数の抽出（可読性低下のシグナル）
    - 未使用変数・errorの未処理の検出等の簡易アンチパターン指摘

#### 2.1.2 AI分析タスク（LLM統合）

- 上記で抽出した関数に対してAI分析支援が可能であること
    - コメント不足の関数へ、AIによる「関数意図を簡潔に説明する1行コメント」提案
    - 可読性の低い変数名に対し、より適切な変数名のリファクタ提案
    - 関数/ファイル全体の人間が理解しやすい要約文の生成
    - 検出したアンチパターンの具体的な改善アドバイス

#### 2.1.3 コマンドラインインターフェース（CLI）

- 引数でGoファイル/ディレクトリ/関数名を指定可能
- 対象ソースコードを解析～AI分析し、結果をコンソールへ出力
    - オプションで「提案内容だけ」「生コードと提案の両方」「json出力」など切り替え可能
- 必要に応じ、対象分析タスクの種別（コメント提案/リファクタ等）を指定可能

#### 2.1.4 その他

- 分析やAI提案の実行に失敗した場合、分かりやすいエラーメッセージを出すこと
- 主要機能単位で自動テスト可能な設計とする  
- ドキュメント（README.md等）にて「概要」「セットアップ手順」「実行例」「制約・今後の課題」を簡潔にまとめること

---

### 2.2 非機能要件

- **動作環境**: Go 1.20以降, Linux/macOS, (llama系モデルが実行可能な環境)
- **応答速度**: 単一関数レベルなら10秒未満を目安（ローカルLLM利用時）
- **拡張性**: プラグイン的に分析タスクの追加が容易な構造とする
- **安全性**: LLMプロンプト注入被害等、思わぬ出力リスクをREADME等で注意喚起

---

### 2.3 技術要件

- **言語**: Go
- **コード静的解析**: go/ast, analysisパッケージ利用
- **AI/LLM統合**: langchaingo
- **ローカルLLM実行**: ollama + CodeLlama, Llama2等
- **実行例**:  
    ```shell
    ./gocodeai analyze --file=main.go --task=comment_suggestion
    ```

---

## 3. 想定ユースケース

- 新人開発者が書いたGoコードの自動レビュー補助
- PRレビューの事前チェック（コメント不足や典型的アンチパターン発見）
- 既存コードベースへのドキュメント付与や統一リファクタアイデア生成
- ChatOpsやCI/CDの補助スクリプト

---

## 4. 開発・テスト計画

1. **Go AST解析・環境セットアップ**
    - LLM/ollama/CodeLlamaインストール、Go CLI雛形作成、簡易AST解析
2. **LLM統合・AI分析ロジック**
    - langchaingoからプロンプト設計、入出力整備、AI提案の整形処理
3. **CLI化・テスト・ドキュメント**
    - コマンドインターフェース実装、制御テスト、小規模なコードでの有効性確認

---

## 5. 制限事項・今後の展望

- ローカル推論環境によるレスポンス遅延や、AIの出力品質は保証されない
- ソース構造が複雑な場合や膨大なファイルは対象外（初期リリース）
- 今後拡張案：gofmtやgoimportsとの連携、自動修正適用機能の追加、サードパーティ静的解析ツールとの併用（GoKartなど）、Web（GitHub PR連携）対応

---

## 6. 参考

- [Go公式ドキュメント - go/ast パッケージ](https://pkg.go.dev/go/ast)
- [langchaingo公式Docs](https://github.com/langchain-ai/langchaingo)
- [Ollama公式サイト](https://ollama.com/)